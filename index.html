<!DOCTYPE html>
<svg id="x_graph" width="960" height="250"></svg>
<svg id="y_graph" width="960" height="250"></svg>
<svg id="z_graph" width="960" height="250"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var WIDTH = 960;
var HEIGHT = 250;

var margin = {top: 40, right: 40, bottom: 40, left: 70};
var width = WIDTH - margin.left - margin.right;
var height = HEIGHT - margin.top - margin.bottom;

function getSVGGroup(svgID)
{
  var svg = d3.select(svgID);
  return(svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")"));
}


var xGroup   = getSVGGroup("#x_graph");
var yGroup   = getSVGGroup("#y_graph");
var zGroup   = getSVGGroup("#z_graph");


var parseTime = d3.timeParse("%d-%b-%y");

var xAxis = d3.scaleTime()
    .rangeRound([0, width]);

var yAxis = d3.scaleLinear()
    .rangeRound([height, 0]);

var d3_line = d3.line()
    .x(function(d) { return xAxis(d.x); })
    .y(function(d) { return yAxis(d.y); });


function update()
{
   d3.json("http://127.0.0.1:8000/api/v1/getrecord/test",
            function(error, response) {
              function yExtent() {
                var x = d3.extent(response, function(d) { return d.x });
                var y = d3.extent(response, function(d) { return d.y });
                var z = d3.extent(response, function(d) { return d.z });

                return [Math.min(x[0], y[0], z[0]), Math.max(x[1], y[1], z[1])];
              }

              if (error) return console.warn(error);

              var xData    = response.map(function(d) { return {x: d.time, y: d.x} });
              var yData    = response.map(function(d) { return {x: d.time, y: d.y} });
              var zData    = response.map(function(d) { return {x: d.time, y: d.z} });

              updateSVG(xGroup, xData, "Time", "X");
              updateSVG(yGroup, yData, "Time", "Y");
              updateSVG(zGroup, zData, "Time", "Z");
            });
}


function updateSVG(svgGroup, data, xName, yName)
{
   xAxis.domain(d3.extent(data, function(d) { return d.x }));
   yAxis.domain(d3.extent(data, function(d) { return d.y }));

   /* remove old data */
   svgGroup.select("#line").remove();
   svgGroup.select("#xAxis").remove();
   svgGroup.select("#yAxis").remove();

   /* add new data */

   svgGroup.append("g")
       .call(d3.axisBottom(xAxis))
       .attr("id", "xAxis")
       .attr("transform", "translate(0," + height + ")")
       .append("text")
       .attr("transform", "translate(" + width / 2 + ", " + margin.bottom / 2 + ")")
       .attr("fill", "#000")
       .text("Time");


   svgGroup.append("g")
       .call(d3.axisLeft(yAxis))
       .attr("id", "yAxis")
       .append("text")
       .attr("fill", "#000")
       /* .attr("transform", "rotate(-90)") */
       .attr("x", 0 - margin.left / 2)
       .attr("y", height / 2)
       .attr("dy", "0.71em")
       .attr("text-anchor", "middle")
       .text("G");

   svgGroup.append("path")
       .datum(data)
       .attr("id", "line")
       .attr("fill", "none")
       .attr("stroke", "red")
       .attr("stroke-linejoin", "round")
       .attr("stroke-linecap", "round")
       .attr("stroke-width", 1.5)
       .attr("d", d3_line);
}


setInterval(update, 100);

</script>

